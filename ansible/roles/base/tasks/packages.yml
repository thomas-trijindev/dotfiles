---
# =============================================================================
# Standard package installation
# =============================================================================

# -----------------------------------------------------------------------------
# Update package cache
# -----------------------------------------------------------------------------

- name: Update package cache (Arch/CachyOS)
  community.general.pacman:
    update_cache: yes
  when: ansible_facts['os_family'] == "Archlinux"

- name: Update package cache (Fedora)
  ansible.builtin.dnf:
    update_cache: yes
  when: ansible_facts['distribution'] == "Fedora"

- name: Update package cache (Ubuntu/Debian)
  ansible.builtin.apt:
    update_cache: yes
    cache_valid_time: 3600
  when: ansible_facts['os_family'] == "Debian"

- name: Update Homebrew (macOS)
  community.general.homebrew:
    update_homebrew: yes
  when: ansible_facts['os_family'] == "Darwin"
  become: no

# -----------------------------------------------------------------------------
# Install packages
# -----------------------------------------------------------------------------

- name: Install packages (Arch/CachyOS)
  community.general.pacman:
    name: "{{ packages_common + packages_arch }}"
    state: present
  when: ansible_facts['os_family'] == "Archlinux"

- name: Install packages (Fedora)
  ansible.builtin.dnf:
    name: "{{ packages_common + packages_fedora }}"
    state: present
  when: ansible_facts['distribution'] == "Fedora"

- name: Install packages (Ubuntu/Debian)
  ansible.builtin.apt:
    name: "{{ packages_common + packages_ubuntu }}"
    state: present
  when: ansible_facts['os_family'] == "Debian"

- name: Install packages (macOS)
  community.general.homebrew:
    name: "{{ packages_common + packages_macos }}"
    state: present
  when: ansible_facts['os_family'] == "Darwin"
  become: no
