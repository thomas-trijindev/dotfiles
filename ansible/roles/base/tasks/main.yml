---
# =============================================================================
# BASE ROLE - roles/base/tasks/main.yml
# =============================================================================
#
# PURPOSE:
#   Entry point for the base role. This role installs packages and tools
#   that should be present on all machines regardless of their purpose.
#
# WHAT THIS ROLE INSTALLS:
#   1. System packages   - Common CLI tools (git, neovim, ripgrep, etc.)
#   2. AUR support       - Paru helper and AUR packages (Arch only)
#   3. NordVPN           - VPN client (optional, controlled by feature flag)
#   4. chezmoi           - Dotfiles manager (optional, controlled by feature flag)
#   5. Claude Code       - AI coding assistant (optional, controlled by feature flag)
#
# HOW TO ADD NEW COMPONENTS:
#   1. Create a new task file (e.g., mytool.yml)
#   2. Add import_tasks entry below with appropriate 'when' condition
#   3. Add feature flag in group_vars/all.yml if it should be optional
#
# HOW TO DISABLE COMPONENTS:
#   Set the feature flag to false in group_vars/all.yml, e.g.:
#     install_nordvpn: false
#
# =============================================================================

# Install standard packages from distribution repositories
# See packages.yml for the package lists
- name: Install standard packages
  ansible.builtin.import_tasks: packages.yml

# Set up AUR (Arch User Repository) support
# Installs paru AUR helper and any packages listed in packages_aur
# Only runs on Arch-based systems (Arch, Manjaro, EndeavourOS, CachyOS, etc.)
- name: Setup AUR support
  ansible.builtin.import_tasks: aur.yml
  when: ansible_facts['os_family'] == "Archlinux"

# Install NordVPN client
# Uses different methods per distro: AUR on Arch, repo on Fedora/Ubuntu, cask on macOS
# Controlled by install_nordvpn variable (default: false)
- name: Install NordVPN
  ansible.builtin.import_tasks: nordvpn.yml
  when: install_nordvpn | default(false)

# Install chezmoi dotfiles manager
# After playbook, run: chezmoi init --apply <github-username>
# Controlled by install_chezmoi variable (default: false)
- name: Install chezmoi
  ansible.builtin.import_tasks: chezmoi.yml
  when: install_chezmoi | default(false)

# Install Claude Code AI assistant CLI
# Downloads from claude.ai official installer
# Controlled by install_claude variable (default: false)
- name: Install Claude Code
  ansible.builtin.import_tasks: claude.yml
  when: install_claude | default(false)
